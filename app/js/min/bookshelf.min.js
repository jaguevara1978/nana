!function(){function e(){return window.pageYOffset||window.document.documentElement.scrollTop}function t(e){this.el=e,this.book=this.el.querySelector(".book"),this.ctrls=this.el.querySelector(".buttons"),this.details=this.el.querySelector(".details"),this._layout(),this.bbWrapper=document.getElementById(this.book.getAttribute("data-book")),this.bbWrapper&&this._initBookBlock(),this._initEvents()}function i(){[].slice.call(c).forEach(function(e){new t(e)})}var n="WebkitAnimation"in document.body.style||"MozAnimation"in document.body.style||"msAnimation"in document.body.style||"OAnimation"in document.body.style||"animation"in document.body.style,o={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},s=o[Modernizr.prefixed("animation")],l=document.getElementById("scroll-wrap"),r=0,c=document.querySelectorAll("#bookshelf > figure");t.prototype._layout=function(){if(Modernizr.csstransforms3d){this.book.innerHTML='<div class="cover"><div class="front"></div><div class="inner inner-left"></div></div><div class="inner inner-right"></div>';var e=document.createElement("div");e.className="perspective",e.appendChild(this.book),this.el.insertBefore(e,this.ctrls)}this.closeDetailsCtrl=document.createElement("span"),this.closeDetailsCtrl.className="close-details",this.details.appendChild(this.closeDetailsCtrl)},t.prototype._initBookBlock=function(){this.bb=new BookBlock(this.bbWrapper.querySelector(".bb-bookblock"),{speed:700,shadowSides:.8,shadowFlip:.4}),this.ctrlBBClose=this.bbWrapper.querySelector(" .bb-nav-close"),this.ctrlBBNext=this.bbWrapper.querySelector(" .bb-nav-next"),this.ctrlBBPrev=this.bbWrapper.querySelector(" .bb-nav-prev")},t.prototype._initEvents=function(){var e=this;this.ctrls&&(this.bb&&(this.ctrls.querySelector("a:nth-child(1)").addEventListener("click",function(t){t.preventDefault(),e._open()}),this.ctrlBBClose.addEventListener("click",function(t){t.preventDefault(),e._close()}),this.ctrlBBNext.addEventListener("click",function(t){t.preventDefault(),e._nextPage()}),this.ctrlBBPrev.addEventListener("click",function(t){t.preventDefault(),e._prevPage()})),this.ctrls.querySelector("a:nth-child(2)").addEventListener("click",function(t){t.preventDefault(),e._showDetails()}),this.closeDetailsCtrl.addEventListener("click",function(){e._hideDetails()}))},t.prototype._open=function(){r=e(),classie.add(this.el,"open"),classie.add(this.bbWrapper,"show");var t=function(){this.removeEventListener(s,t),document.body.scrollTop=document.documentElement.scrollTop=0,classie.add(l,"hide-overflow")};n?this.bbWrapper.addEventListener(s,t):t.call()},t.prototype._close=function(){classie.remove(l,"hide-overflow"),setTimeout(function(){document.body.scrollTop=document.documentElement.scrollTop=r},25),classie.remove(this.el,"open"),classie.add(this.el,"close"),classie.remove(this.bbWrapper,"show"),classie.add(this.bbWrapper,"hide");var e=this,t=function(){this.removeEventListener(s,t),e.bb.jump(1),classie.remove(e.el,"close"),classie.remove(e.bbWrapper,"hide")};n?this.bbWrapper.addEventListener(s,t):t.call()},t.prototype._nextPage=function(){this.bb.next()},t.prototype._prevPage=function(){this.bb.prev()},t.prototype._showDetails=function(){classie.add(this.el,"details-open")},t.prototype._hideDetails=function(){classie.remove(this.el,"details-open")},i()}();